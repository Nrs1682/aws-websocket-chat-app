<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AWS WebSocket Chat</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      display: flex;
      justify-content: center;
      padding-top: 40px;
    }

    .chat-container {
      width: 420px;
      background: #111827;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      padding: 20px;
      color: white;
    }

    h2 {
      text-align: center;
      color: #60a5fa;
    }

    .header {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    input {
      padding: 8px;
      border-radius: 6px;
      border: none;
      outline: none;
      width: 100%;
    }

    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background: #1d4ed8;
    }

    #messages {
      height: 300px;
      overflow-y: auto;
      background: #020617;
      padding: 10px;
      border-radius: 8px;
      list-style: none;
    }

    #messages li {
      margin-bottom: 8px;
      padding: 6px;
      border-radius: 6px;
      background: #0b1220;
    }

    .me {
      background: #064e3b !important;
    }

    .sender {
      font-weight: bold;
      color: #38bdf8;
    }

    .input-area {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<div class="chat-container">

  <h2>AWS WebSocket Chat ðŸ’¬</h2>

  <div class="header">
    <input id="usernameInput" placeholder="Enter your name"/>
    <button onclick="connect()">Connect</button>
  </div>

  <ul id="messages"></ul>

  <div class="input-area">
    <input id="messageInput" placeholder="Type message..."/>
    <button onclick="sendMessage()">Send</button>
  </div>

</div>

<script>
let ws;
let username = "";

function connect() {
  username = document.getElementById("usernameInput").value;

  if (!username) {
    alert("Please enter your name first");
    return;
  }

  ws = new WebSocket(
   "wss://msy536iv94.execute-api.ap-south-1.amazonaws.com/production"
  );

  ws.onopen = () => {
    addMessage("System", "Connected as " + username, false);
  };

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    const sender = data.username || "Anonymous";
    const text = data.message || "";

    addMessage(sender, text, sender === username);
  };

  ws.onerror = (e) => console.error("WebSocket error:", e);

  ws.onclose = () => {
    addMessage("System", "Disconnected", false);
  };
}

function addMessage(sender, text, isMe) {
  const li = document.createElement("li");

  li.innerHTML = `
    <span class="sender">${sender}:</span> ${text}
  `;

  if (isMe) li.classList.add("me");

  document.getElementById("messages").appendChild(li);
}

function sendMessage() {
  const msg = document.getElementById("messageInput").value;

  if (!ws || ws.readyState !== WebSocket.OPEN) {
    alert("Connect first!");
    return;
  }

  ws.send(JSON.stringify({
    action: "sendMessage",
    username: username,
    message: msg
  }));

  document.getElementById("messageInput").value = "";
}
</script>

</body>
</html>
